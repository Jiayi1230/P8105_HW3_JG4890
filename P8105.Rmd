---
title: "P8105_HW3_JG4890"
author: "Jiayi Ge"
date: "2024-10-09"
output: github_document
---
# Problem 1
Import and clean Dataset
```{r}
library(p8105.datasets)
library(dplyr)
library(janitor)
library(lubridate)
data("ny_noaa")
noaa_clean <- ny_noaa %>%
  janitor::clean_names() %>%
#Change the units into a more reasonable ones
  mutate(
    prcp = as.numeric(prcp) / 10, 
    tmax = as.numeric(tmax) / 10, 
    tmin = as.numeric(tmin) / 10,
    snwd = as.numeric(snwd) / 10
  )%>%
  
#Create separate variables for year, month, and day
  mutate(year = year(date), month = month(date), day = day(date))
head(noaa_clean)
print(noaa_clean)
```
Size and Structure: The NOAA dataset contains daily weather data from several stations in New York State. The dataset has `r nrow(ny_noaa)` rows and `r ncol(ny_noaa)` columns which is over 2.5 million rows and multiple columns such as `id`, `date`, `tmax`, `tmin`, `prcp`, `snwd`, and `snow`.

Key Variables:

`id`: Identifies the weather station. Weather station ID.

`date`: The date of the observation.

`tmax`, `tmin`: Maximum and minimum temperatures in tenths of degrees Celsius.

`prcp`: Precipitation in tenths of millimeters.

`snow`: Snowfall in millimeters.

`snwd`: Snow depth mm.

`Missing Data`: Missing data is prevalent, especially for temperature and precipitation measurements.

**Ensure observations in reasonable units**

`tmax` and `tmin` (maximum and minimum temperature) are recorded in tenths of degrees Celsius, so dividing by 10 converts them to standard 째C.

`prcp` (precipitation) is recorded in tenths of millimeters, so dividing by 10 converts it to millimeters.

`snwd` (snow depth) is recorded in millimeters, but since snow depth is typically expressed in centimeters, dividing by 10 converts it to cm.

```{r}
#To identify the most common snowfall values
noaa_clean %>%
  count(snow) %>%
  arrange(desc(n)) %>%
  head(5)

```

**Most commonly observed values For Snowfall**: The most common snowfall value is 0, which means there is no snow on most days.




**Plot showing the average max temperature in January and in July in each station across years**
```{r}
library(ggplot2)
# Summarize average max temperature for January and July
jan_jul_summary <- noaa_clean %>%
  filter(month %in% c(1, 7)) %>%
  group_by(year, month,id) %>%
  summarize(avg_tmax = mean(tmax, na.rm = TRUE), .groups = "drop")
# Convert month to a factor for better plotting
jan_jul_summary <- jan_jul_summary %>%
  mutate(month = factor(month, labels = c("January", "July")))

# Create a bar plot for average max temperature
ggplot(jan_jul_summary, aes(x = factor(year), y = avg_tmax)) +
  geom_point() +
  facet_grid(. ~ month) +
  scale_x_discrete(breaks = seq(min(jan_jul_summary$year), max(jan_jul_summary$year), by = 5)) +
  labs(title = "Average Max Temperature in January and July",
       x = "Year",
       y = "Average Max Temperature (째C)") 
```
In January, the average max temperature is generally lower than in July.Meanwhile, the average maximum temperature in July appears to be more stable than the average maximum temperature in January. In the January chart, there are several outliers in both the upper and lower regions of the distribution, and there is more variation overall. In July, some individual outliers were below the overdistribution, but the overall level was stable.

**(i) `tmax` vs `tmin` for the full datase**
```{r}
# Create a heatmap for tmax vs tmin
ggplot(noaa_clean, aes(x = tmin, y = tmax)) +
  geom_bin2d(bins = 50) +
  scale_fill_viridis_c() + 
  labs(title = "Heatmap of Maximum vs Minimum Temperatures",
       x = "Minimum Temperature (째C)",
       y = "Maximum Temperature (째C)") +
  theme_minimal()

```


**(ii) The distribution of snowfall values greater than 0 and less than 100 separately by year**
```{r}
snowfall_filtered <- noaa_clean %>%
  filter(snwd > 0 & snwd < 100)

ggplot(snowfall_filtered, aes(x = factor(year), y = snwd)) +
  geom_boxplot() +
  labs(title = "Distribution of Snowfall (0 < Snowfall < 100) by Year",
       x = "Year",
       y = "Snowfall (mm)") +
  theme_minimal() +
  scale_x_discrete(breaks = seq(min(snowfall_filtered$year), max(snowfall_filtered$year), by = 5))  # Display every 5 years

```

# Problem 2
Import data for problem 2
```{r}
library(readr)
nhanes_accel = 
  read_csv("./nhanes_accel.csv", na = c("NA", ",", "")) %>%
  janitor::clean_names()
nhanes_covar = 
  read_csv("./nhanes_covar.csv", na = c("NA", ",", ""),skip = 4) %>%
  janitor::clean_names()
```


